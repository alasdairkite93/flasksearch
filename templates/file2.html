<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Property Search: Lettings</title>
<link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='foundation.css') }}">

      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

 <link rel="stylesheet" href=
"https://cdn.jsdelivr.net/npm/foundation-sites@6.7.4/dist/css/foundation.min.css"
        crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/foundation-sites@6.7.5/dist/js/foundation.min.js" crossorigin="anonymous"></script>
<link rel="stylesheet" type="text/css" href="semantic/dist/semantic.min.css">
<script
  src="https://code.jquery.com/jquery-3.1.1.min.js"
  integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
  crossorigin="anonymous"></script>
        <script src="https://code.jquery.com/jquery-1.9.1.min.js"></script>

<script src="semantic/dist/semantic.min.js"></script>
     <!-- Compressed JavaScript -->
     <script src=
"https://cdnjs.cloudflare.com/ajax/libs/foundation/6.0.1/js/vendor/jquery.min.js">
    </script>
     <script src=
"https://cdn.jsdelivr.net/npm/foundation-sites@6.5.1/dist/js/foundation.min.js"
       crossorigin="anonymous">
     </script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js">
    </script>
    <script type=text/javascript>

    /**Land Registry**/
        $(function(){
            $('a#soldpricejson').click(function(){
                $.get("/landregistry", function (data){
                    soldLR(data, 0);
                });
            });
        });

        /**Zoopla Requests**/

        $(function(){
            $('a#zooplasale').click(function() {
                $.get("/zooplasale", function (data){
                    forSale(data, 0);
                })
            })
        });

        $(function(){
            $('a#zooplalets').click(function() {
                $.get("/zooplalet", function (data){
                    forSale(data, 5);
                })
            })
        });

        /**Right Move AJAX Requests**/
        $(function(){
            $('a#rmovesale').click(function() {
                $.get("/rightmovesale", function (data){
                    forSale(data, 1);
                })
            })
        });

        $(function(){
            $('a#rmovelets').click(function() {
                $.get("/rmoverent", function (data){
                    forSale(data, 3);
                })
            })
        });

        /**ONtheMarket AJAX Requests**/

         $(function(){
            $('a#otmsale').click(function() {
                $.get("/otmsale", function (data){
                    forSale(data, 2);
                })
            })
        });

          $(function(){
            $('a#otmrent').click(function() {
                $.get("/otmrent", function (data){
                    forSale(data, 4);
                })
            })
        });


    /**Sold Prices**/

    $(function(){
            $('a#rmovesold').click(function() {
                $.get("/rmovesold", function (data){
                    sold(data);
                })
            })
        });


    /**Area Statistics**/

    $(function() {
        $('a#crysdata').click(function() {
            $.get("/crystalroof", function (data){
                planning(data);
                {#soldLR(data, 1);#}
            })
        })
    });

    /**Planning Data**/

    $(function() {
        $('a#planningdata').click(function() {
            $.get("/planningdata", function (data){
                planning(data);
            })
        })
    });

    /**body on load function**/

    function crysData(json_data){
        const section = document.getElementById('forsale');
        section.innerHTML="";

        const table = document.createElement("table");
        table.setAttribute("class", "table");

        const thead = document.createElement("thead");

        const th = document.createElement("th");
        th.setAttribute("scope", "col");

        const label = document.createElement("th");
        label.setAttribute("scope", "col");

        for (entry of json_data) {

            console.log(entry);

            for (let i = 0; i < entry.length; i++) {
                for (let key of entry[i]) {
                    if (col.indexOf(key) === -1) {
                        col.push(key);
                    }
                }
            }


        }


        th.innerHTML="#";
        data.innerHTML = "Data";

        const tr = document.createElement("tr");
        tr.appendChild(th);
        tr.appendChild(label);
        tr.appendChild(data);

        thead.appendChild(tr);
        table.appendChild(thead);

        const tbody = document.createElement("tbody");
        table.appendChild(tbody);

        //Create table data rows here
        for (var i=0; i<json_data.length; i++){

            const tr = document.createElement("tr");
            const num = document.createElement("th");
            num.setAttribute("scope", "col");
            num.innerHTML = headers[i];
            const td = document.createElement("td");
            td.innerHTML = JSON.stringify(json_data[i]);
            tr.appendChild(td);
            tbody.appendChild(tr);
        }

        section.appendChild(tbody);
    }

    function soldLR(json_data, ind){

        const section = document.getElementById('forsale');
        section.innerHTML="";

        //proposed to aad a function to add search filters here

        var table = document.createElement('table');
        table.border = "1";


        var headers = new Array();
        switch (ind){
            case 0:
                headers.push("LAND REGISTRY: Address", "Price", "Date");
                var headerrow = table.insertRow(-1);
                for (var i =0; i<headers.length; i++) {
                    var headerc = document.createElement("TH");
                    headerc.innerHTML=headers[i];
                    headerrow.append(headerc);
                }
                for (entry of json_data) {
                    row = table.insertRow(-1);
                    for (var i =0; i<entry.length; i++){
                        var cell = row.insertCell(-1);
                        cell.innerHTML = entry[i];
                    }
                }
                break;
            case 1:
                headers.push("RIGHT MOVE: Description", "Data");
                var headerrow = table.insertRow(-1);
                for (var i =0; i<headers.length; i++) {
                    var headerc = document.createElement("TH");
                    headerc.innerHTML=headers[i];
                    headerrow.append(headerc);
                }
                for (entry of json_data){
                    row = table.insertRow(-1);

                    var cell1 = row.insertCell(-1);
                    cell1.innerHTML = entry[0];


                    var cell2 = row.insertCell(-1);
                    cell2.innerHTML = entry[1];
                }
                break;
        }
        section.appendChild(table);
    }

    function planning(json_data){
        const section = document.getElementById('forsale');
        section.innerHTML = "";

        for (entry of json_data){

            let col = [];

            for (let i = 0; i <entry.length; i++){
                for (let key in entry[i]){
                    if (col.indexOf(key) === -1){
                        col.push(key);
                    }
                }
            }

            const table = document.createElement("table");

            let tr = table.insertRow(-1);

            for (let i =0; i< col.length; i++){
                let th = document.createElement("th");
                th.innerHTML = col[i];
                tr.appendChild(th);
            }

            for (let i=0; i<entry.length; i++)
            {
                tr = table.insertRow(-1);

                for (let j=0; j<col.length; j++){
                    let tabcel = tr.insertCell(-1);
                    let text = entry[i][col[j]];
                    let patt = 'https?:\/\/';
                    try {
                        let result = text.match(patt);
                        if (result != null){
                            const a = document.createElement("a");
                            a.setAttribute("href", entry[i][col[j]]);
                            a.innerHTML = entry[i][col[j]];
                            tabcel.appendChild(a);
                        }
                        else {
                            tabcel.innerHTML = entry[i][col[j]];
                        }
                    } catch (error){}
                }
            }

            section.appendChild(table);

        }


    }

    function forSale(json_data, ind){

        var index = parseInt(ind);
        const section = document.getElementById('forsale');
        section.innerHTML = "";
        const title = document.createElement("h4");
        var url = ''
        var endurl = ''

        switch(index) {
            case 0:
                const ti_cont = document.createTextNode("Zoopla Rent Results");
                title.appendChild(ti_cont);
                url = 'https://www.zoopla.co.uk/for-sale/details/';
                break;
            case 1:
                const rmov_txt = document.createTextNode("{{ session['postcode'] }} Sale Results from Rightmove");
                title.appendChild(rmov_txt);
                url = 'https://www.rightmove.co.uk/properties/';
                break;
            case 2:
                const ontm_txt = document.createTextNode("{{ session['postcode'] }} Sales Results from on The Market");
                title.appendChild(ontm_txt);
                url = 'https://www.onthemarket.com'
                break;
            case 3:
                const rmov_lets = document.createTextNode("{{ session['postcode'] }} Lettings on Rightmove");
                title.appendChild(rmov_lets);
                url = 'https://www.rightmove.co.uk/properties/'
                endurl = '#/?channel=RES_LET';
                break;
            case 4:
                const ontm_lets = document.createTextNode("{{ session['postcode'] }} on The Market Lettings");
                title.appendChild(ontm_lets);
                url = 'https://www.onthemarket.com'
                break;
            case 5:
                const zoop_lets = document.createTextNode("Zoopla Lettings");
                title.appendChild(zoop_lets);
                url = 'https://www.zoopla.co.uk/to-rent/details/'
                break;
            }

        section.appendChild(title);

        var number = json_data.length;
        const count = document.createTextNode("Number of properties: "+number);
        title.appendChild(count);



        for (prop of json_data) {

            const newDiv = document.createElement("div");
            newDiv.setAttribute("class", "card mb-3");
            newDiv.setAttribute("style", "max-width: 540px;");
            section.appendChild(newDiv);

            const rowdiv2 = document.createElement("div");
            rowdiv2.setAttribute("class", "row no-gutters");
            newDiv.appendChild(rowdiv2);

            const rowdiv = document.createElement("div");
            rowdiv.setAttribute("class", "row no-gutters");
            newDiv.appendChild(rowdiv);

            const divcolmd8 = document.createElement("div");
            divcolmd8.setAttribute("class", "col-md-8");
            rowdiv.appendChild(divcolmd8);
            const cardbody = document.createElement("div");
            cardbody.setAttribute("class", "card=body");
            divcolmd8.appendChild(cardbody);

            for (var i =0; i<prop.length; i++){

                switch (i){
                    case 0:
                        const h5 = document.createElement("h5");
                        const h5_content = document.createTextNode(prop[i]);
                        h5.appendChild(h5_content);
                        cardbody.appendChild(h5);
                        break;
                    case 1:
                        const p = document.createElement("p");
                        const p_content = document.createTextNode(prop[i]);
                        p.appendChild(p_content);
                        cardbody.appendChild(p);
                        break;
                    case 2:
                        const p_branch = document.createElement("p");
                        const b_cont = document.createTextNode(prop[i]);
                        p_branch.appendChild(b_cont);
                        cardbody.appendChild(p_branch);
                        break;
                    case 3:
                        const p_rooms = document.createElement("p");
                        const room_cont = document.createTextNode(prop[i]);
                        p_rooms.appendChild(room_cont);
                        cardbody.appendChild(p_rooms);
                        break;
                    case 4:
                        const p_price = document.createElement("p");
                        const pric_cont = document.createTextNode(prop[i]);
                        p_price.appendChild(pric_cont);
                        cardbody.appendChild(p_price);
                        break;
                    case 5:
                        const coldiv = document.createElement("div");
                        coldiv.setAttribute("class", "col-md-4");
                        const anchor = document.createElement("a");
                        anchor.setAttribute("href", prop[i]);
                        const img = document.createElement("img");
                        img.src = prop[i+1];
                        anchor.appendChild(img);
                        coldiv.appendChild(anchor);
                        rowdiv.appendChild(coldiv);
                        break;
                    case 6:
                        break;
                }
            }
        }
    }

    function sold(json_data){

        const section = document.getElementById('forsale');
        section.innerHTML = "";
        const title = document.createElement("h1");
        const rmov_sold = document.createTextNode("RightMove Sold");
        title.appendChild(rmov_sold);
        section.appendChild(title);

        var number = json_data.length;
        const count = document.createTextNode("Total Number of Properties: "+number);
        title.appendChild(count);

        for (const prop of json_data) {

            const myArticle = document.createElement('article');

            const address = prop[0];
            const price = prop[1];
            const image = prop[2];
            const url = prop[3];

            const h2 = document.createElement("h3");
            const addr_cont = document.createTextNode(address);
            h2.appendChild(addr_cont);

            const list = document.createElement('ul');

            const img = document.createElement('li');
            img.textContent = image;
            list.appendChild(img);

            //Creating sublist of prices property has been sold for
            const sublist = document.createElement('ul');
            price.forEach((item)=>{
                let li = document.createElement("li");
                li.innerText = item;
                sublist.appendChild(li);
            })
            list.appendChild(sublist);

            const url_listing = document.createElement('li');
            url_listing.textContent = url;
            list.appendChild(url_listing);

            myArticle.appendChild(h2);
            myArticle.appendChild(list);

            section.appendChild(myArticle);
      }

    }

    function setMinP(val){
        const minp = document.getElementById('mpc');
        minp.innerHTML = val;
    }

    </script>
    <style>

    input {
            display: inline;
        }

    .button{
      background-color: #f5f5f5;
      border:none;
      color:#707070;
      font-size:15px;
      padding: 10px 20px;
      margin:5px;
      border-radius:4px;
      outline:none;
    }
    .button:hover{
      border: 1px solid #c8c8c8;
      padding: 9px 19px;
      color:#808080;
    }
    .button:focus{
      border:1px solid #4885ed;
      padding: 9px 19px;
    }

    </style>
</head>
<body >
<ul class="nav nav-pills navbar-left">
  <li class="nav-item">
    <a class="nav-link active" href="#">Active</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="#">Link</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="#">Link</a>
  </li>
  <li class="nav-item">
    <a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true">Disabled</a>
  </li>
</ul>
<div class="container" style="padding-top: 100px;">
<header class="hero-search-filter">
  <div class="hero-search-filter-content">
    <img class="hero-search-filter-logo" src="https://placehold.it/160x80" alt="" />
    <form class="hero-search-filter-form" action="{{ url_for("update_pcode") }}">
    <div class="input-group input-group-rounded">
        <input class="input-group-field" type="text" name="pcodeupdate" placeholder="{{ session['postcode'] }}">
        <div class="input-group-button">
            <input type="submit" class="button secondary" value="Search">
        </div>
    </div>
    </form>
      <ul class="hero-search-filter-menu menu align-center">
      <li><a href="#"><i class="fa fa-cutlery" aria-hidden="true"></i>
          <form action="{{ url_for("update_rooms") }}" method="post" name="minrooms">
                <div class="form-group">
                    <label for="minrooms" style="font-size: 10px; text-align: center;">Number of Beds</label>
                    <select id="minrooms" class="form-select form-select-sm" name="minrooms" style="width: 100px; font-size: 12px;" onchange="this.form.submit()">
                        <option value="{{ session['brooms'] }}">{{ session['brooms'] }}</option>
                        <option value="0">Studio</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                    </select>
                </div>
            </form>
      </a>
      </li>
      <li><a href="#"><i class="fa fa-glass" aria-hidden="true"></i>
      <form action="{{ url_for("update_radius") }}" method="post" name="radius">
            <div class="form-group">
             <label for="radius" style="font-size: 10px;">Enter search radius:</label>
                <select id="radius" class="form-select form-select-sm" style="width: 100px; font-size: 12px;" onchange="this.form.submit()" name="radius">
                    <option>{{ session['radius'] }} miles</option>
                    <option value="0">+0 miles</option>
                    <option value="0.25">+1/4 miles</option>
                    <option value="0.5">+1/2 miles</option>
                    <option value="1">+1 miles</option>
                    <option value="2">+2 miles</option>
                    <option value="3">+3 miles</option>
                    <option value="5">+5 miles</option>
                    <option value="10">+10 miles</option>
                    <option value="15">+15 miles</option>
                    <option value="20">+20 miles</option>
                    <option value="30">+30 miles</option>
                    <option value="40">+40 miles</option>
                </select>
            </div>
        </form></a>
      </li>
      <li>
           <a href="#"><i class="fa fa-wrench" aria-hidden="true"></i>
            <form action="{{ url_for("update_min_price") }}" style="width: 100px; " id="minprice" method="post" name="minprice">
            <div class="form-group">
              <label for="minprice" style="font-size: 10px;">Select minimum price</label>
                <select id="minpriceoptions" name="minprice" style="font-size: 12px;" onchange="this.form.submit()">
                    <option value="100">{{ session['minprice'] }}</option>
                    <option value="150">150 PCM</option>
                    <option value="200">200 PCM</option>
                    <option value="250">250 PCM</option>
                    <option value="300">300 PCM</option>
                    <option value="350">350 PCM</option>
                    <option value="400">400 PCM</option>
                    <option value="450">450 PCM</option>
                    <option value="500">500 PCM</option>
                    <option value="600">600 PCM</option>
                    <option value="700">700 PCM</option>
                    <option value="800">800 PCM</option>
                    <option value="900">900 PCM</option>
                    <option value="1000">1,000 PCM</option>
                    <option value="1100">1,100 PCM</option>
                    <option value="1200">1,200 PCM</option>
                    <option value="1250">1,250 PCM</option>
                    <option value="1300">1,300 PCM</option>
                    <option value="1400">1,400 PCM</option>
                    <option value="1500">1,500 PCM</option>
                    <option value="1750">1,750 PCM</option>
                    <option value="2000">2,000 PCM</option>
                    <option value="2250">2,250 PCM</option>
                    <option value="2500">2,500 PCM</option>
                    <option value="2750">2,750 PCM</option>
                    <option value="3000">3,000 PCM</option>
                    <option value="3500">3,500 PCM</option>
                    <option value="4000">4,000 PCM</option>
                    <option value="4500">4,500 PCM</option>
                    <option value="5000">5,000 PCM</option>
                    <option value="5500">5,500 PCM</option>
                    <option value="6000">6,000 PCM</option>
                    <option value="6500">6,500 PCM</option>
                    <option value="7000">7,000 PCM</option>
                    <option value="8000">8,000 PCM</option>
                    <option value="9000">9,000 PCM</option>
                    <option value="10000">10,000 PCM</option>
                    <option value="12500">12,500 PCM</option>
                    <option value="15000">15,000 PCM</option>
                    <option value="17500">17,500 PCM</option>
                    <option value="20000">20,000 PCM</option>
                    <option value="25000">25,000 PCM</option>
                    <option value="30000">30,000 PCM</option>
                    <option value="35000">35,000 PCM</option>
                    <option value="40000">40,000 PCM</option>
                </select>
            </div>
        </form>
      </a>
      </li>
      <li>
         <a href="#"><i class="fa fa-cutlery" aria-hidden="true"></i>
            <form action="{{ url_for("update_max_price") }}" id="maxprice" style="width: 100px; " method="post" name="maxprice">
            <div class="form-group">
        <label for="maxprice" style="font-size: 10px;">Select max price</label>
        <select id="maxprice" name="maxprice" style="font-size: 12px;" onchange="this.form.submit()">
           <option value="100">{{ session['maxprice'] }}</option>
            <option value="150">150 PCM</option>
            <option value="200">200 PCM</option>
            <option value="250">250 PCM</option>
            <option value="300">300 PCM</option>
            <option value="350">350 PCM</option>
            <option value="400">400 PCM</option>
            <option value="450">450 PCM</option>
            <option value="500">500 PCM</option>
            <option value="600">600 PCM</option>
            <option value="700">700 PCM</option>
            <option value="800">800 PCM</option>
            <option value="900">900 PCM</option>
            <option value="1000">1,000 PCM</option>
            <option value="1100">1,100 PCM</option>
            <option value="1200">1,200 PCM</option>
            <option value="1250">1,250 PCM</option>
            <option value="1300">1,300 PCM</option>
            <option value="1400">1,400 PCM</option>
            <option value="1500">1,500 PCM</option>
            <option value="1750">1,750 PCM</option>
            <option value="2000">2,000 PCM</option>
            <option value="2250">2,250 PCM</option>
            <option value="2500">2,500 PCM</option>
            <option value="2750">2,750 PCM</option>
            <option value="3000">3,000 PCM</option>
            <option value="3500">3,500 PCM</option>
            <option value="4000">4,000 PCM</option>
            <option value="4500">4,500 PCM</option>
            <option value="5000">5,000 PCM</option>
            <option value="5500">5,500 PCM</option>
            <option value="6000">6,000 PCM</option>
            <option value="6500">6,500 PCM</option>
            <option value="7000">7,000 PCM</option>
            <option value="8000">8,000 PCM</option>
            <option value="9000">9,000 PCM</option>
            <option value="10000">10,000 PCM</option>
            <option value="12500">12,500 PCM</option>
            <option value="15000">15,000 PCM</option>
            <option value="17500">17,500 PCM</option>
            <option value="20000">20,000 PCM</option>
            <option value="25000">25,000 PCM</option>
            <option value="30000">30,000 PCM</option>
            <option value="35000">35,000 PCM</option>
            <option value="40000">40,000 PCM</option>
        </select>
    </div>
            </form>
         </a>
      </li>
    </ul>
      <ul class="hero-search-filter-menu menu align-center">
          <li><a href="#"><i class="fa fa-cutlery" aria-hidden="true"></i>
           <div class="dropdown show">
            <a class="dropdown-toggle" data-toggle="dropdown">To Rent
            <span class="caret"></span></a>
                <ul class="dropdown-menu">
                    <li><a href=# id=rmovesale>RightMove</a></li>
                    <li><a href=# id=otmsale>OnTheMarket</a></li>
                </ul>
            </div>
          </a></li>
          <li><a href="#"><i class="fa fa-glass" aria-hidden="true"></i>
          <div class="dropdown">
              <a class="dropdown-toggle" data-toggle="dropdown" id=planningdata>Land Planning</a>
            </div>
          </a></li>
          <li><a href="#"><i class="fa fa-wrench" aria-hidden="true"></i>
                <div class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown">Local Area Statistics
                    <span class="caret"></span></a>
                    <ul class="dropdown-menu">
                        <li><a href=# id=crysdata>Tables</a></li>
                    </ul>
                </div>
            </a>
          </li>
          <li><a href="#"><i class="fa fa-cutlery" aria-hidden="true"></i>
              <div class="dropdown">
                <a class="dropdown-toggle" data-toggle="dropdown">Transactions
                <span class="caret"></span></a>
                <ul class="dropdown-menu">
                    <li><a href=# id=soldpricejson>Land Registry Sold</a></li>
                    <li><a href=# id=rmovesold>RightMove Sold</a></li>
                </ul>
            </div>
          </a>
      </li>
    </ul>
  </div>
</header>
</div>
<script>
    $(document).foundation();
</script>
<span id=result></span>

<div id="forsale" class="container" style="padding-top: 75px;"></div>

</body>

</html>