<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Title</title>

      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

 <link rel="stylesheet" href=
"https://cdn.jsdelivr.net/npm/foundation-sites@6.7.4/dist/css/foundation.min.css"
        crossorigin="anonymous">

     <!-- Compressed JavaScript -->
     <script src=
"https://cdnjs.cloudflare.com/ajax/libs/foundation/6.0.1/js/vendor/jquery.min.js">
    </script>
     <script src=
"https://cdn.jsdelivr.net/npm/foundation-sites@6.5.1/dist/js/foundation.min.js"
       crossorigin="anonymous">
     </script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js">
    </script>
    <script type=text/javascript>

    /**Land Registry**/
        $(function(){
            $('a#soldpricejson').click(function(){
                $.get("/landregistry", function (data){
                    soldLR(data, 0);
                });
            });
        });

        /**Zoopla Requests**/

        $(function(){
            $('a#zooplasale').click(function() {
                $.get("/zooplasale", function (data){
                    forSale(data, 0);
                })
            })
        });

        $(function(){
            $('a#zooplalets').click(function() {
                $.get("/zooplalet", function (data){
                    forSale(data, 5);
                })
            })
        });

        /**Right Move AJAX Requests**/
        $(function(){
            $('a#rmovesale').click(function() {
                $.get("/rightmovesale", function (data){
                    forSale(data, 1);
                })
            })
        });

        $(function(){
            $('a#rmovelets').click(function() {
                $.get("/rmoverent", function (data){
                    forSale(data, 3);
                })
            })
        });

        /**ONtheMarket AJAX Requests**/

         $(function(){
            $('a#otmsale').click(function() {
                $.get("/otmsale", function (data){
                    forSale(data, 2);
                })
            })
        });

          $(function(){
            $('a#otmrent').click(function() {
                $.get("/otmrent", function (data){
                    forSale(data, 4);
                })
            })
        });


    /**Sold Prices**/

    $(function(){
            $('a#rmovesold').click(function() {
                $.get("/rmovesold", function (data){
                    sold(data);
                })
            })
        });


    /**Area Statistics**/

    $(function() {
        $('a#crysdata').click(function() {
            $.get("/crystalroof", function (data){
                soldLR(data, 1);
            })
        })
    });

    /**Planning Data**/

    $(function() {
        $('a#planningdata').click(function() {
            $.get("/planningdata", function (data){
                planning(data);
            })
        })
    });

    function soldLR(json_data, ind){

        const section = document.getElementById('forsale');
        section.innerHTML="";
        var table = document.createElement('table');
        table.border = "1";

        console.log(json_data);

        var headers = new Array();
        switch (ind){
            case 0:
                headers.push("LAND REGISTRY: Address", "Price", "Date");
                var headerrow = table.insertRow(-1);
                for (var i =0; i<headers.length; i++) {
                    var headerc = document.createElement("TH");
                    headerc.innerHTML=headers[i];
                    headerrow.append(headerc);
                }
                for (entry of json_data) {
                    row = table.insertRow(-1);
                    for (var i =0; i<entry.length; i++){
                        var cell = row.insertCell(-1);
                        cell.innerHTML = entry[i];
                    }
                }
                break;
            case 1:
                headers.push("RIGHT MOVE: Description", "Data");
                var headerrow = table.insertRow(-1);
                for (var i =0; i<headers.length; i++) {
                    var headerc = document.createElement("TH");
                    headerc.innerHTML=headers[i];
                    headerrow.append(headerc);
                }
                for (entry of json_data){
                    console.log("Entry length: "+entry.length);
                    row = table.insertRow(-1);

                    var cell1 = row.insertCell(-1);
                    cell1.innerHTML = entry[0];


                    var cell2 = row.insertCell(-1);
                    cell2.innerHTML = entry[1];
                }
                break;
        }
        section.appendChild(table);
    }

    function planning(json_data){
        const section = document.getElementById('forsale');
        section.innerHTML = "";

        for (entry of json_data){
            var table = document.createElement('table');

            for (var i=0; i<entry.length; i++){
                var tr = document.createElement('tr');
                var td = document.createElement('td');
                var txt = document.createTextNode(entry[i]);
                td.appendChild(txt);
                tr.appendChild(td);
                table.appendChild(tr);
            }

            section.appendChild(table);
        }
    }

    function forSale(json_data, ind){

        var index = parseInt(ind);
        const section = document.getElementById('forsale');
        section.innerHTML = "";
        const title = document.createElement("h1");
        var url = ''
        var endurl = ''

        switch(index) {
            case 0:
                const ti_cont = document.createTextNode("Zoopla For Sale Results");
                title.appendChild(ti_cont);
                url = 'https://www.zoopla.co.uk/for-sale/details/';
                break;
            case 1:
                const rmov_txt = document.createTextNode("RightMove For Sale Results");
                title.appendChild(rmov_txt);
                url = 'https://www.rightmove.co.uk/properties/';
                break;
            case 2:
                const ontm_txt = document.createTextNode("On The Market For Sale Results");
                title.appendChild(ontm_txt);
                url = 'https://www.onthemarket.com'
                break;
            case 3:
                const rmov_lets = document.createTextNode("RightMove Lettings");
                title.appendChild(rmov_lets);
                url = 'https://www.rightmove.co.uk/properties/'
                endurl = '#/?channel=RES_LET';
                break;
            case 4:
                const ontm_lets = document.createTextNode("On The Market Lettings");
                title.appendChild(ontm_lets);
                url = 'https://www.onthemarket.com'
                break;
            case 5:
                const zoop_lets = document.createTextNode("Zoopla Lettings");
                title.appendChild(zoop_lets);
                url = 'https://www.zoopla.co.uk/to-rent/details/'
                break;
            }

        section.appendChild(title);

        var number = json_data.length;
        const count = document.createTextNode("Total Number of Properties: "+number);
        title.appendChild(count);



        for (prop of json_data) {

            const newDiv = document.createElement("div");
            newDiv.setAttribute("class", "card mb-3");
            newDiv.setAttribute("style", "max-width: 540px;");
            section.appendChild(newDiv);

            const rowdiv2 = document.createElement("div");
            rowdiv2.setAttribute("class", "row no-gutters");
            newDiv.appendChild(rowdiv2);

            const rowdiv = document.createElement("div");
            rowdiv.setAttribute("class", "row no-gutters");
            newDiv.appendChild(rowdiv);

            const divcolmd8 = document.createElement("div");
            divcolmd8.setAttribute("class", "col-md-8");
            rowdiv.appendChild(divcolmd8);
            const cardbody = document.createElement("div");
            cardbody.setAttribute("class", "card=body");
            divcolmd8.appendChild(cardbody);

            for (var i =0; i<prop.length; i++){

                switch (i){
                    case 0:
                        const h5 = document.createElement("h5");
                        const h5_content = document.createTextNode(prop[i]);
                        h5.appendChild(h5_content);
                        cardbody.appendChild(h5);
                        break;
                    case 1:
                        const p = document.createElement("p");
                        const p_content = document.createTextNode(prop[i]);
                        p.appendChild(p_content);
                        cardbody.appendChild(p);
                        break;
                    case 2:
                        const p_branch = document.createElement("p");
                        const b_cont = document.createTextNode(prop[i]);
                        p_branch.appendChild(b_cont);
                        cardbody.appendChild(p_branch);
                        break;
                    case 3:
                        const p_rooms = document.createElement("p");
                        const room_cont = document.createTextNode(prop[i]);
                        p_rooms.appendChild(room_cont);
                        cardbody.appendChild(p_rooms);
                        break;
                    case 4:
                        const p_price = document.createElement("p");
                        const pric_cont = document.createTextNode(prop[i]);
                        p_price.appendChild(pric_cont);
                        cardbody.appendChild(p_price);
                        break;
                    case 5:
                        const coldiv = document.createElement("div");
                        coldiv.setAttribute("class", "col-md-4");
                        const anchor = document.createElement("a");
                        anchor.setAttribute("href", prop[i]);
                        anchor.setAttribute("target", "blank");
                        const img = document.createElement("img");
                        img.src = prop[i+1];
                        anchor.appendChild(img);
                        coldiv.appendChild(anchor);
                        rowdiv.appendChild(coldiv);
                        break;
                    case 6:
                        break;
                }
            }
        }
    }

    function sold(json_data){

        const section = document.getElementById('forsale');
        section.innerHTML = "";
        const title = document.createElement("h1");
        const rmov_sold = document.createTextNode("RightMove Sold");
        title.appendChild(rmov_sold);
        section.appendChild(title);

        var number = json_data.length;
        const count = document.createTextNode("Total Number of Properties: "+number);
        title.appendChild(count);

        for (const prop of json_data) {

            const myArticle = document.createElement('article');

            const address = prop[0];
            const price = prop[1];
            const image = prop[2];
            const url = prop[3];

            const h2 = document.createElement("h3");
            const addr_cont = document.createTextNode(address);
            h2.appendChild(addr_cont);

            const list = document.createElement('ul');

            const img = document.createElement('li');
            img.textContent = image;
            list.appendChild(img);

            //Creating sublist of prices property has been sold for
            const sublist = document.createElement('ul');
            price.forEach((item)=>{
                let li = document.createElement("li");
                li.innerText = item;
                sublist.appendChild(li);
            })
            list.appendChild(sublist);

            const url_listing = document.createElement('li');
            url_listing.textContent = url;
            list.appendChild(url_listing);

            myArticle.appendChild(h2);
            myArticle.appendChild(list);

            section.appendChild(myArticle);
      }
    }

    {#function crysStats(data){#}
    {##}
    {#    const section = document.getElementById('forsale');#}
    {#    section.innerHTML = "";#}
    {#    const title = document.createElement("h1");#}
    {#    const rmov_sold = document.createTextNode("RightMove Sold");#}
    {#    title.appendChild(rmov_sold);#}
    {#    section.appendChild(title);#}
    {##}
    {#    row_num = data.length();#}
    {#    col_num = 2;#}
    {#    var table = document.createElement("TABLE");#}
    {#    table.setAttribute("id", "crys_table");#}
    {#    section.appendChild(table);#}
    {#    for (const entry of data){#}
    {#        #}
    {#    }#}

    </script>
    <style>
        .item {
        width: 10em;
    }

         .buttons{
    margin-top:30px;
    }
    .button{
      background-color: #f5f5f5;
      border:none;
      color:#707070;
      font-size:15px;
      padding: 10px 20px;
      margin:5px;
      border-radius:4px;
      outline:none;
    }
    .button:hover{
      border: 1px solid #c8c8c8;
      padding: 9px 19px;
      color:#808080;
    }
    .button:focus{
      border:1px solid #4885ed;
      padding: 9px 19px;
    }
    .bar{
      margin:0 auto;
      width:575px;
      border-radius:30px;
    }
    .bar:hover{
      box-shadow: 1px 1px 8px 1px #dcdcdc;
    }
    .bar:focus-within{
      box-shadow: 1px 1px 8px 1px #dcdcdc;
      outline:none;
    }
    .searchbar{
      height:45px;
      border:none;
      width:500px;
      font-size:16px;
        margin-left: 20px;
    }

    .voice{
      height:20px;
      position:relative;
      top:5px;
      left:10px;
    }
    </style>
</head>
<body>

<div class="container" style="padding-top: 50px;">
        <form action="{{ url_for("update_pcode")}}" method="post" name="search" onsubmit="return validateForm()">
        <div class="form-group">
            <div class="item">
                <div class="bar" >
                  <input class="searchbar" type="text"  id="postcode" name="pcode" title="Search" placeholder="Enter postcode..." required>
                  <a href="#"> <img class="voice" src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e8/Google_mic.svg/716px-Google_mic.svg.png" title="Search by Voice"></a>
                </div>
                <div class="buttons">
                    <button class="button" type="submit" >Search</button>
                </div>
            </div>
        </div>
        </form>
</div>

<div class="container">
    <form action="{{ url_for("update_rooms") }}" method="post" name="minrooms">
        <div class="form-group">
            <label for="minrooms">Enter number of bedrooms</label>
            <select id="minrooms" name="minrooms" onchange="this.form.submit()">
                <option value="studio">Studio</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
            </select>
        </div>
    </form>
        <form action="{{ url_for("update_radius") }}" method="post" name="radius">
        <div class="form-group">
         <label for="radius">Enter search radius:</label>
            <select id="radius" onchange="this.form.submit()" name="radius">
                <option value="0">+0 miles</option>
                <option value="0.25">+1/4 miles</option>
                <option value="0.5">+1/2 miles</option>
                <option value="1">+1 miles</option>
                <option value="2">+2 miles</option>
                <option value="3">+3 miles</option>
                <option value="5">+5 miles</option>
                <option value="10">+10 miles</option>
                <option value="15">+15 miles</option>
                <option value="20">+20 miles</option>
                <option value="30">+30 miles</option>
                <option value="40">+40 miles</option>
            </select>
        </div>
    </form>

    <form action="{{ url_for("update_min_price") }}" method="post" name="minprice">
        <div class="form-group">
          <label for="minprice">Select minimum price</label>
            <select id="minprice" name="minprice" onchange="this.form.submit()">
                 <option value="100">100 PCM</option>
                <option value="150">150 PCM</option>
                <option value="200">200 PCM</option>
                <option value="250">250 PCM</option>
                <option value="300">300 PCM</option>
                <option value="350">350 PCM</option>
                <option value="400">400 PCM</option>
                <option value="450">450 PCM</option>
                <option value="500">500 PCM</option>
                <option value="600">600 PCM</option>
                <option value="700">700 PCM</option>
                <option value="800">800 PCM</option>
                <option value="900">900 PCM</option>
                <option value="1000">1,000 PCM</option>
                <option value="1100">1,100 PCM</option>
                <option value="1200">1,200 PCM</option>
                <option value="1250">1,250 PCM</option>
                <option value="1300">1,300 PCM</option>
                <option value="1400">1,400 PCM</option>
                <option value="1500">1,500 PCM</option>
                <option value="1750">1,750 PCM</option>
                <option value="2000">2,000 PCM</option>
                <option value="2250">2,250 PCM</option>
                <option value="2500">2,500 PCM</option>
                <option value="2750">2,750 PCM</option>
                <option value="3000">3,000 PCM</option>
                <option value="3500">3,500 PCM</option>
                <option value="4000">4,000 PCM</option>
                <option value="4500">4,500 PCM</option>
                <option value="5000">5,000 PCM</option>
                <option value="5500">5,500 PCM</option>
                <option value="6000">6,000 PCM</option>
                <option value="6500">6,500 PCM</option>
                <option value="7000">7,000 PCM</option>
                <option value="8000">8,000 PCM</option>
                <option value="9000">9,000 PCM</option>
                <option value="10000">10,000 PCM</option>
                <option value="12500">12,500 PCM</option>
                <option value="15000">15,000 PCM</option>
                <option value="17500">17,500 PCM</option>
                <option value="20000">20,000 PCM</option>
                <option value="25000">25,000 PCM</option>
                <option value="30000">30,000 PCM</option>
                <option value="35000">35,000 PCM</option>
                <option value="40000">40,000 PCM</option>
            </select>
        </div>
    </form>
    <form action="{{ url_for("update_max_price") }}" method="post" name="maxprice">
    <div class="form-group">
        <label for="maxprice">Select max price</label>
        <select id="maxprice" name="maxprice" onchange="this.form.submit()">
             <option value="100">100 PCM</option>
                <option value="150">150 PCM</option>
                <option value="200">200 PCM</option>
                <option value="250">250 PCM</option>
                <option value="300">300 PCM</option>
                <option value="350">350 PCM</option>
                <option value="400">400 PCM</option>
                <option value="450">450 PCM</option>
                <option value="500">500 PCM</option>
                <option value="600">600 PCM</option>
                <option value="700">700 PCM</option>
                <option value="800">800 PCM</option>
                <option value="900">900 PCM</option>
                <option value="1000">1,000 PCM</option>
                <option value="1100">1,100 PCM</option>
                <option value="1200">1,200 PCM</option>
                <option value="1250">1,250 PCM</option>
                <option value="1300">1,300 PCM</option>
                <option value="1400">1,400 PCM</option>
                <option value="1500">1,500 PCM</option>
                <option value="1750">1,750 PCM</option>
                <option value="2000">2,000 PCM</option>
                <option value="2250">2,250 PCM</option>
                <option value="2500">2,500 PCM</option>
                <option value="2750">2,750 PCM</option>
                <option value="3000">3,000 PCM</option>
                <option value="3500">3,500 PCM</option>
                <option value="4000">4,000 PCM</option>
                <option value="4500">4,500 PCM</option>
                <option value="5000">5,000 PCM</option>
                <option value="5500">5,500 PCM</option>
                <option value="6000">6,000 PCM</option>
                <option value="6500">6,500 PCM</option>
                <option value="7000">7,000 PCM</option>
                <option value="8000">8,000 PCM</option>
                <option value="9000">9,000 PCM</option>
                <option value="10000">10,000 PCM</option>
                <option value="12500">12,500 PCM</option>
                <option value="15000">15,000 PCM</option>
                <option value="17500">17,500 PCM</option>
                <option value="20000">20,000 PCM</option>
                <option value="25000">25,000 PCM</option>
                <option value="30000">30,000 PCM</option>
                <option value="35000">35,000 PCM</option>
                <option value="40000">40,000 PCM</option>
        </select>
    </div>
    </form>
</div>
<div class="container">
    <ul>
        <li>PostCode: {{ session['postcode'] }}</li>
        <li>Radius: {{ session['radius'] }}</li>
        <li>Rooms: {{ session['brooms'] }}</li>
        <li>Minimum Price: {{ session['minprice'] }}</li>
        <li>Max price: {{ session['maxprice'] }}</li>
    </ul>
</div>
<div class="container" style="align-items: center;">
    <ul class="dropdown menu" data-dropown-menu>
{#        <li class="list-group-item">#}
{#            <div class="dropdown show">#}
{#            <a class="dropdown-toggle" data-toggle="dropdown">For Sale#}
{#            <span class="caret"></span></a>#}
{#                <ul class="dropdown-menu">#}
{#                    <li><a href=# id=zooplasale>Zoopla</a></li>#}
{#                    <li><a href=# id=rmovesale>RightMove</a></li>#}
{#                    <li><a href=# id=otmsale>OnTheMarket</a></li>#}
{#                </ul>#}
{#            </div>#}
{#        </li>#}

        <li class="list-group-item">
            <div class="dropdown">
            <a class="dropdown-toggle" data-toggle="dropdown">Lettings
            <span class="caret"></span></a>
                <ul class="dropdown-menu">
{#                    <li><a href=# id=zooplalets>Zoopla</a></li>#}
                    <li><a href=# id=rmovelets>RightMove</a></li>
                    <li><a href=# id=otmrent>On The Market</a></li>
                </ul>
            </div>
        </li>
        <li class="list-group-item">
            <div class="dropdown">
                <a class="dropdown-toggle" data-toggle="dropdown">Transactions
                <span class="caret"></span></a>
                <ul class="dropdown-menu">
                    <li><a href=# id=soldpricejson>Land Registry Sold</a></li>
                    <li><a href=# id=rmovesold>RightMove Sold</a></li>
                </ul>
            </div>
        </li>
        <li class="list-group-item">
            <div class="dropdown">
                <a class="dropdown-toggle" data-toggle="dropdown">Local Area Data
                <span class="caret"></span></a>
                <ul class="dropdown-menu">
                    <li><a href=# id=crysdata>CrystalRoof Data</a></li>
                </ul>
            </div>
        </li>
        <li class="list-group-item">
            <div class="dropdown">
                <a class="dropdown-toggle" data-toggle="dropdown">Land Planning
                <span class="caret"></span></a>
                <ul class="dropdown-menu">
                    <li><a href=# id=planningdata>Data</a></li>
                </ul>
            </div>
        </li>
    </ul>
</div>
<script>
    $(document).foundation();
</script>
<span id=result></span>

<div id="forsale" class="container" style="padding-top: 75px;"></div>

</body>

</html>