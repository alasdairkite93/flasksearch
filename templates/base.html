<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-M9L1LM9C7V"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }

        gtag('js', new Date());

        gtag('config', 'G-M9L1LM9C7V');
    </script>

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="refresh"/>
    <title>Property Scanner: Results</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static',filename='foundation.css') }}">
    <link rel="stylesheet" href="https://cdn.korzh.com/metroui/v4/css/metro-all.min.css">


    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://kit.fontawesome.com/f3f39947b8.css" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.3/dist/jquery.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/foundation-sites@6.7.4/dist/css/foundation.min.css"
          crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/foundation-sites@6.7.5/dist/js/foundation.min.js"
            crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"
            integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/foundation/6.0.1/js/vendor/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/foundation-sites@6.5.1/dist/js/foundation.min.js"
            crossorigin="anonymous">
    </script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script type=text/javascript>

        window.addEventListener("popstate", (event) => {
            window.location.href = "http://127.0.0.1:5000/";
        });

        window.onhashchange = function () {
            window.location.href = "http://127.0.0.1:5000/";
        }

        $(document).ajaxSend(function () {
            loading();
        });

        $(document).ready(function () {
            $.get("/pageload", function (data) {
                history.pushState([data], ['rmovesale']); // replace with appropriate values as parameters
                forSale(data, 8);
            })
        });


        var renderData = function (data) {
            console.log('render data:', data);
        }

        window.onpopstate = function (e) {
            e.preventDefault();

            if (e.state) {
                var data = e.state;
                renderData(data);
            }
        }

        function onclicks() {
            const clickevents = document.getElementById("soldpricejson");
            let x = {{ session['postcode'] }};
            if (x.length <= 5) {
                clickevents.setAttribute("style", "pointer-events: none;");
            }
        }

        function loading() {

            const section = document.getElementById("forsale");
            section.innerHTML = "";
            const button = document.createElement("button");
            button.setAttribute("class", "buttonload");
            button.setAttribute("style", "font-size: 20px; background-color: white; border: 1px solid black; padding-bottom: 20px;  border-radius: 5px; padding-top: 15px; padding-bottom: 15px;")
            button.innerText = "Searching for properties this may take a few seconds.";
            const i = document.createElement('i');
            i.setAttribute('class', 'fa fa-circle-o-notch fa-spin');
            i.setAttribute('style', 'font-size: 100px; margin-top: 40px;');
            button.appendChild(i);
            section.appendChild(button);
        }

        /**Land Registry**/

        $(function () {
            $('a#soldpricejson').click(function () {

                $.get("/landregistry", function (data) {
                    console.log(data);
                    soldLR(data, 0);
                    history.pushState([data], ['landregistry']); // replace with appropriate values as parameters
                })
                    .fail(function (jqXHR, error, textStatus, errorThrown) {
                        alert(errorThrown + "Only full postcodes can be used with this feature.");
                    })
            });
        });


        /**Update number of results**/

        $(function () {
            $('a#formupdate').click(function () {
                let x = document.getElementById("formupdate").value
                $.ajax({
                    url: '/pagination',
                    data: x,
                    type: "POST",
                    success: function (response) {
                        history.pushState([response], ['formupdate']); // replace with appropriate values as parameters

                        console.log(response);
                    },
                    error: function (error) {
                        console.log(error);
                    }
                });
            })
        });

        $(function () {

            $('#numres').click(function () {
                $.ajax({
                    url: '/numres',
                    data: $('form').serialize(),
                    type: 'POST',
                    success: function (response) {
                        history.pushState([response], ['numres']); // replace with appropriate values as parameters

                        console.log(response);
                    },
                    error: function (error) {
                        console.log(error);
                    }
                });
            })
        });

        /**Gumtree Request**/

        $(function () {
            $('a#gumtree').click(function () {

                $.get("/gumtreesales", function (data) {
                    forSale(data);
                })
            })
        });


        /**Right Move AJAX Requests**/


        $(function () {
            $('a#rmovesale').click(function () {
                console.log("rmove sale ajax");
                $.get("/rightmovesale", 2, function (data) {
                    console.log("get path rmove sale");
                    history.pushState([forSale(data)], ['rmovesale']); // replace with appropriate values as parameters
                    forSale(data, 1);
                })
            })
        });


        $(function () {
            $('a#rmovelets').click(function () {
                $.get("/rmoverent", function (data) {
                    history.pushState([data], ['rmovelets']); // replace with appropriate values as parameters
                    forSale(data, 3);

                })
            })
        });

        /**ONtheMarket AJAX Requests**/

        $(function () {
            $('a#otmsale').click(function () {
                $.get("/otmsale", function (data) {
                    history.pushState([data], ['otmsale']); // replace with appropriate values as parameters
                    forSale(data, 2);
                })
            })
        });

        $(function () {
            $('a#otmrent').click(function () {
                $.get("/otmrent", function (data) {
                    history.pushState([data], ['otmrent']); // replace with appropriate values as parameters
                    forSale(data, 4);
                })
            })
        });

        /**Sold Prices**/

        $(function () {
            $('a#rmovesold').click(function () {
                $.get("/rmovesold", function (data) {
                    history.pushState([data], ['rmovesold']); // replace with appropriate values as parameters
                    soldTable(data);
                    {#sold(data);#}
                })
                    .fail(function (jqXHR, textStatus, errorThrown) {
                        alert(errorThrown + "Only a full postcode can be used with this feature.");
                    })
            })
        });

        $(function () {
            $('a#crysdata').click(function () {


                $.get("/crystalroof", function (data) {

                    history.pushState([data], ['crysdata']); // replace with appropriate values as parameters
                    crysData(data);
                })

                    .fail(function (jqXHR, textStatus, errorThrown) {
                        alert(errorThrown + "Only a full postcode can be used with this feature.");
                    })
            })
        });

        /**Planning Data**/

        $(function () {
            $('a#planningdata').click(function () {
                $.get("/planningdata", function (data) {
                    history.pushState([data], ['planningdata']); // replace with appropriate values as parameters
                    planning(data);
                })
                    .fail(function (jqXHR, textStatus, errorThrown) {
                        alert(errorThrown + " Try using correct format of postcode");
                    })
            })
        });

        /**Sales and lettings pages**/

        $(function () {
            $('a#lettingspage').click(function () {
                $.get("/returnall", function (data) {
                    history.pushState([data], ['returnalllettings']); // replace with appropriate values as parameters
                    all(data);
                })
                    .fail(function (jqXHR, textStatus, errorThrown) {
                        alert(errorThrown + " Try using correct format of postcode");
                    })
            })
        });

        /**Return all sales**/

        $(function () {
            $('a#allsales').click(function () {
                $.get("/returnall", function (data) {
                    history.pushState([data], ['returnallsales']); // replace with appropriate values as parameters
                    forSale(data);
                })
                    .fail(function (jqXHR, textStatus, errorThrown) {
                        alert("DID NOT RETURN ALL RESUTLS");
                    })
            })
        });

        $(function () {
            $('a#zooplasales').click(function () {
                $.get("/zooplasale", function (data) {
                    forSale(data);
                })
            })
        })

        /**Dropdowns **/

        /**body on load function**/


        function updateToLettings() {
            //change session variable to lettings
            //refresh the page

            location.reload();
        }

        function all(json_data) {

            const section = document.getElementById('forsale');
            section.innerHTML = "";


        }

        function crysData(json_data) {

            const section = document.getElementById('forsale');
            section.innerHTML = "";

            const table = document.createElement("table");
            table.setAttribute("class", "table");

            /**Table header**/

            const thead = document.createElement("thead");
            table.appendChild(thead);
            const trel = document.createElement("tr");
            table.appendChild(trel);

            const thlabel = document.createElement("th");
            thlabel.setAttribute("scope", "col");
            thlabel.innerHTML = 'Label';
            table.appendChild(thlabel);

            const thdata = document.createElement("th");
            thdata.setAttribute("scope", "col");
            thdata.innerHTML = 'Data';
            table.appendChild(thdata);

            /**table body**/

            const tbody = document.createElement("tbody");
            table.appendChild(tbody);

            //Create array of headers and loop through for label as loop over entries
            var headers = [];
            headers.push("Supergroupname", "Supergroupdescription", "Groupname", "Groupdescription",
                "Indicies of Deprvation", "Mean Income", "Median Income", "Crime Rate", "Crime Rank", "Metro Name",
                "Rail Name", "Supermarkets", "Groceries", "Schools",
                "Road Noise", "Rail Noise", "Aircraft Noise", "White British", "White Irish", "Gypsy",
                "Other White", "Mixed", "Indian", "Pakistani", "Bangladeshi", "Chinese",
                "Other Asian", "Black", "Arab", "Other", "Christian", "Buddhist",
                "Hindu", "Jewish", "Muslim", "Sikh", "Other", "No Religion", "One Person Household",
                "Couple with Children", "Couple without Children", "Same Sex Couple", "Lone Parent with Children",
                "Lone Parent without Children", "Multi Person Student", "Other Multi Person", "Age Under 35",
                "Age 35 to 54", "Age 55 to 64", "Above 65");

            let i = 0;
            for (const [, value] of Object.entries(json_data)) {
                const trbody = document.createElement("tr");
                tbody.appendChild(trbody);
                const td_label = document.createElement("td");
                td_label.innerHTML = headers[i];
                trbody.appendChild(td_label);
                const td_data = document.createElement("td");
                if (value == null) {
                    td_data.innerHTML = "Null"
                } else {
                    td_data.innerHTML = value;
                }
                trbody.appendChild(td_data);
                i++;
            }

            section.appendChild(table);

        }

        function soldLR(json_data, ind) {

            const section = document.getElementById('forsale');
            section.innerHTML = "";

            //proposed to aad a function to add search filters here
            if (json_data.length > 0) {

                var table = document.createElement('table');
                table.setAttribute("class", "table");
                table.border = "1";

                console.log("LENGTH OF JSON: " + json_data.length);

                var headers = new Array();
                switch (ind) {
                    case 0:
                        headers.push("LAND REGISTRY: Address", "Price", "Date");
                        var headerrow = table.insertRow(-1);
                        for (var i = 0; i < headers.length; i++) {
                            var headerc = document.createElement("TH");
                            headerc.innerHTML = headers[i];
                            headerrow.append(headerc);
                        }
                        for (entry of json_data) {
                            row = table.insertRow(-1);
                            for (var i = 0; i < entry.length; i++) {
                                var cell = row.insertCell(-1);
                                cell.innerHTML = entry[i];
                            }
                        }
                        break;
                    case 1:
                        headers.push("RIGHT MOVE: Description", "Data");
                        var headerrow = table.insertRow(-1);
                        for (var i = 0; i < headers.length; i++) {
                            var headerc = document.createElement("TH");
                            headerc.innerHTML = headers[i];
                            headerrow.append(headerc);
                        }
                        for (entry of json_data) {
                            row = table.insertRow(-1);

                            var cell1 = row.insertCell(-1);
                            cell1.innerHTML = entry[0];


                            var cell2 = row.insertCell(-1);
                            cell2.innerHTML = entry[1];
                        }
                        break;
                }
                section.appendChild(table);
            } else {
                const message = document.createElement('p');
                message.textContent = "No Results to Display";
                message.setAttribute("style", "text-aling: center;")
                section.appendChild(message);
            }
        }

        function  planning(json_data) {
            const section = document.getElementById('forsale');
            section.innerHTML = "";

            for (entry of json_data) {

                let col = [];

                for (let i = 0; i < entry.length; i++) {
                    for (let key in entry[i]) {
                        if (col.indexOf(key) === -1) {
                            col.push(key);
                        }
                    }
                }

                const table = document.createElement("table");
                table.setAttribute("class", "table");

                let tr = table.insertRow(-1);

                for (let i = 0; i < col.length; i++) {
                    let th = document.createElement("th");
                    th.innerHTML = col[i];
                    tr.appendChild(th);
                }

                for (let i = 0; i < entry.length; i++) {
                    tr = table.insertRow(-1);

                    for (let j = 0; j < col.length; j++) {
                        let tabcel = tr.insertCell(-1);
                        let text = entry[i][col[j]];
                        let patt = 'https?:\/\/';
                        try {
                            let result = text.match(patt);
                            if (result != null) {
                                const a = document.createElement("a");
                                a.setAttribute("href", entry[i][col[j]]);
                                a.innerHTML = entry[i][col[j]];
                                tabcel.appendChild(a);
                            } else {
                                tabcel.innerHTML = entry[i][col[j]];
                            }
                        } catch (error) {
                        }
                    }
                }

                section.appendChild(table);

            }
        }

        function forSale(json_data, ind) {

            console.log(ind)
            console.log("Javascript for sale function");


            var index = parseInt(ind);

            const section = document.getElementById('forsale');
            section.innerHTML = "";

            const title = document.createElement("h4");
            var url = ''
            var id = ''
            var endurl = ''
            var sec = '';

            var number = json_data.length;


            switch (index) {
                case 0:
                    const ti_cont = document.createTextNode("Zoopla For Sale Results " + number);
                    title.appendChild(ti_cont);
                    url = 'https://www.zoopla.co.uk/for-sale/details/';
                    break;
                case 1:
                    const rmov_txt = document.createTextNode("{{ session['postcode'] }} Sale Results from Rightmove: " + number);
                    sec = 'forsale'
                    title.appendChild(rmov_txt);
                    id = 'rmovesale'
                    url = 'https://www.rightmove.co.uk/properties/';
                    break;
                case 2:
                    const ontm_txt = document.createTextNode("{{ session['postcode'] }} Sales Results from on The Market " + number);
                    sec = 'OTM'
                    title.appendChild(ontm_txt);
                    url = 'https://www.onthemarket.com'
                    break;
                case 3:
                    const rmov_lets = document.createTextNode("{{ session['postcode'] }} Lettings on Rightmove " + number);
                    sec = 'forsale'
                    title.appendChild(rmov_lets);
                    url = 'https://www.rightmove.co.uk/properties/'
                    endurl = '#/?channel=RES_LET';
                    break;
                case 4:
                    const ontm_lets = document.createTextNode("{{ session['postcode'] }} on The Market Lettings");
                    sec = 'OTM'
                    title.appendChild(ontm_lets);
                    url = 'https://www.onthemarket.com'
                    break;
                case 5:
                    const zoop_lets = document.createTextNode("Zoopla Lettings");
                    title.appendChild(zoop_lets);
                    url = 'https://www.zoopla.co.uk/to-rent/details/'
                    break;
                case 6:
                    const gumtreesales = document.createTextNode("Gumtree Sales");
                    title.appendChild(gumtreesales);
                    url = 'https://www.gumtree.com/'
                    break;
                case 7:
                    const alltitle = document.createTextNode("All Sales");
                    title.appendChild(alltitle);
                    break;
                case 9:
                    const results = document.createTextNode("Results");
                    title.appendChild(results);
                    break;
            }

            const c = document.getElementById('sessionvariable');
            console.log("json_data.length: " + json_data.length);
            if (json_data.length == 0) {
                c.innerText = 'No results to display'
            }

            section.appendChild(title);
            for (prop of json_data) {

                console.log("prop[3]: " + prop[3]);
                const p_notag = prop[3].replace('£', '');
                console.log("p_notag: " + p_notag);
                let p_nocomma = p_notag.replace(',', '');

                try {
                    p_nocomma = p_nocomma.replace(' pcm', '');
                } catch (err) {
                    pass
                }


                const newDiv = document.createElement("div");
                newDiv.setAttribute("class", "card child");
                newDiv.setAttribute("data-percentage", p_nocomma);
                newDiv.setAttribute("id", "newdivattribute");
                newDiv.setAttribute("style", "margin-left: 3%; min-width: 70%; border-radius: 10px;");
                section.appendChild(newDiv);

                const rowdiv = document.createElement("div");
                rowdiv.setAttribute("class", "row no-gutters");
                newDiv.appendChild(rowdiv);

                const coldiv = document.createElement("div");
                coldiv.setAttribute("class", "col-md-4");
                coldiv.setAttribute("style", "background-color: #1A2090; border: 0.1px solid; place-items: center;");
                const img_anch = document.createElement("a");
                img_anch.setAttribute("href", prop[4]);
                const img = document.createElement("img");
                img.src = prop[5];
                img.setAttribute("id", "imgdynamic");
                img.setAttribute("id", "imagescreen")
                img.setAttribute("style", "display: block; margin-left: auto; margin-right: auto; padding-top: 20px; padding-left: 10px;")
                img_anch.appendChild(img);
                coldiv.appendChild(img_anch);
                rowdiv.appendChild(coldiv);

                console.log(prop[7]);

                if (prop[7] != undefined) {
                    const price = document.createElement("h5");
                    price.setAttribute("style", "text-align: center; padding-top: 10px; color: white;")
                    const price_fig = document.createTextNode(prop[7]);
                    price.appendChild(price_fig);
                    coldiv.appendChild(price);
                } else {
                    {% if session['type'] == 'lettings' %}
                        const price = document.createElement("h5");
                        price.setAttribute("style", "text-align: center; padding-top: 10px; color: white;")

                        const price_fig = document.createTextNode(prop[3]);

                        price.appendChild(price_fig);
                        coldiv.appendChild(price);
                    {% endif %}
                    {% if session['type'] == 'sales' %}
                        const saleprice = document.createElement("h5");
                        saleprice.setAttribute("style", "text-align: center; padding-top: 10px; color: white;")
                        const saleprice_fig = document.createTextNode(prop[3]);
                        saleprice.appendChild(saleprice_fig);
                        coldiv.appendChild(saleprice);
                    {% endif %}
                }


                const divcolmd8 = document.createElement("div");
                divcolmd8.setAttribute("class", "col-md-8");
                divcolmd8.setAttribute("style", "padding-top: 10px;");
                rowdiv.appendChild(divcolmd8);
                const cardbody = document.createElement("div");
                cardbody.setAttribute("class", "card-body");
                cardbody.setAttribute("id", "cardcontent");
                divcolmd8.appendChild(cardbody);

                const anchor = document.createElement("a");
                url = prop[4];
                anchor.setAttribute("href", url);

                const dispaddres = document.createElement("h5");
                const add_cont = document.createTextNode(prop[0]);
                dispaddres.appendChild(add_cont);
                anchor.appendChild(dispaddres);
                cardbody.appendChild(anchor);

                const branchname = document.createElement("p");
                const branch_cont = document.createTextNode("Branch: " + prop[1]);
                branchname.appendChild(branch_cont);
                cardbody.appendChild(branchname);

                const bedrooms = document.createElement("p");
                const bed_rooms = document.createTextNode("Rooms: " + prop[2]);
                bedrooms.appendChild(bed_rooms);
                cardbody.appendChild(bedrooms);

                if (prop[7] != undefined) {
                    const price_cont = document.createElement("p");
                    const price_con = document.createTextNode("Price: " + prop[7]);
                    price_cont.appendChild(price_con);
                    cardbody.appendChild(price_cont);
                } else {
                    const price_cont = document.createElement("p");
                    const price_con = document.createTextNode("Price: " + prop[3]);
                    price_cont.appendChild(price_con);
                    cardbody.appendChild(price_cont);
                }


                const soure = document.createElement("p");
                const sourc_cont = document.createTextNode("Source: " + prop[6])
                soure.appendChild(sourc_cont);
                cardbody.appendChild(soure);


            }


            var $wrap = $('#forsale');
            $wrap.find('.child').sort(function (a, b) {
                return +b.dataset.percentage -
                    +a.dataset.percentage;
            })
                .appendTo($wrap);
            {#section.appendChild(paginate(4, id));#}


            return;
        }

        function gumtree(data) {

            console.log("GUMTREE")

            const section = document.getElementById('forsale');
            section.innerHTML = "";

            baseurl = 'https://www.gumtree.com'

            for (prop of data) {

                const newDiv = document.createElement("div");
                newDiv.setAttribute("class", "card mb-6");
                newDiv.setAttribute("style", "max-width: 840px;");
                section.appendChild(newDiv);

                const rowdiv2 = document.createElement("div");
                rowdiv2.setAttribute("class", "row no-gutters");
                newDiv.appendChild(rowdiv2);

                const rowdiv = document.createElement("div");
                rowdiv.setAttribute("class", "row no-gutters");
                newDiv.appendChild(rowdiv);

                const divcolmd8 = document.createElement("div");
                divcolmd8.setAttribute("class", "col-md-8");
                rowdiv.appendChild(divcolmd8);
                const cardbody = document.createElement("div");
                cardbody.setAttribute("class", "card=body");
                divcolmd8.appendChild(cardbody);

                const anchor = document.createElement("a");
                url = baseurl + prop[0];
                anchor.setAttribute("href", url);

                const dispaddres = document.createElement("h5");
                const add_cont = document.createTextNode(prop[1]);
                dispaddres.appendChild(add_cont);
                anchor.appendChild(dispaddres);
                cardbody.appendChild(anchor);

                const price = document.createElement("p");
                const price_cont = document.createTextNode(prop[2]);
                price.appendChild(price_cont);
                cardbody.appendChild(price);

                const description = document.createElement("p");
                const desc_cont = document.createTextNode(prop[3]);
                description.appendChild(desc_cont);
                cardbody.appendChild(description);

                const coldiv = document.createElement("div");
                coldiv.setAttribute("class", "col-md-4");
                const img_anch = document.createElement("a");
                img_anch.setAttribute("href", baseurl + prop[0]);
                const img = document.createElement("img");
                img.src = prop[4];
                img_anch.appendChild(img);
                coldiv.appendChild(img_anch);
                rowdiv.appendChild(coldiv);
            }
            return;
        }

        function soldTable(json_data) {

            const section = document.getElementById('forsale');
            section.innerHTML = "";
            const table = document.createElement('table');
            table.style.border = '1px solid black';

            if (json_data.length > 0) {
                for (const prop of json_data) {

                    const tr = table.insertRow();

                    const image = prop[2];
                    console.log("image: " + image);
                    const td_img = tr.insertCell();
                    const img = document.createElement('img');
                    img.src = image;
                    const url = prop[3];
                    const a_tag = document.createElement('a');
                    a_tag.setAttribute('href', url);
                    a_tag.appendChild(img);

                    td_img.appendChild(a_tag);
                    const address = prop[0];
                    const td_add = tr.insertCell();
                    td_add.appendChild(document.createTextNode(address));

                    const price = prop[1];
                    const td_price = tr.insertCell();
                    const sublist = document.createElement('ul');
                    price.forEach((item) => {
                        let li = document.createElement("li");
                        li.innerText = item;
                        sublist.appendChild(li);
                    })
                    console.log(sublist);
                    td_price.appendChild(sublist);

                }

                section.appendChild(table);
            } else {
                const message = document.createElement("p");
                message.textContent = "No Results to Display";
                section.appendChild(message);
            }

        }

        function sold(json_data) {

            const section = document.getElementById('forsale');
            section.innerHTML = "";
            const title = document.createElement("h1");
            const rmov_sold = document.createTextNode("RightMove Sold");
            title.appendChild(rmov_sold);
            section.appendChild(title);

            console.log("LENGTH OF JSON: " + json_data.length)

            var number = json_data.length;
            const count = document.createTextNode("Total Number of Properties: " + number);
            title.appendChild(count);

            for (const prop of json_data) {

                const myArticle = document.createElement('article');

                const address = prop[0];
                const price = prop[1];
                const image = prop[2];
                const url = prop[3];

                const h2 = document.createElement("h3");
                const addr_cont = document.createTextNode(address);
                h2.appendChild(addr_cont);

                const list = document.createElement('ul');

                const img = document.createElement('li');
                img.textContent = image;
                list.appendChild(img);

                //Creating sublist of prices property has been sold for
                const sublist = document.createElement('ul');
                price.forEach((item) => {
                    let li = document.createElement("li");
                    li.innerText = item;
                    sublist.appendChild(li);
                })
                list.appendChild(sublist);

                const url_listing = document.createElement('li');
                url_listing.textContent = url;
                list.appendChild(url_listing);

                myArticle.appendChild(h2);
                myArticle.appendChild(list);

                section.appendChild(myArticle);
            }

        }


    </script>
    <style>

        .buttonload {

        }

        #spinner {
            animation: spin 1s linear infinite;
            color: red;
            background-color: #e9e9eb;
        }

        @keyframes spin {
            100% {
                transform: rotate(360deg);
            }
        }

        .inline {
            display: flex;
        }

        .spinner i {
            padding-top: 20px;
            margin-top: 10px;
            margin-left: 50px;
        }

        ::placeholder {
            color: black;
            font-size: 10px;
        }

        #selection {
            width: auto;
            font-size: 15px;
        }

        input {
            display: inline;
        }

        /* Turn off scrollbar when body element has the loading class */
        body.loading {
            overflow: hidden;
            min-height: 800px;
        }

        /* Make spinner image visible when body element has the loading class */
        body.loading .overlay {
            display: block;
        }

        h1, body, select, option, a, ul, li, h1, h2, h3, h4, h5 {
            font-family: 'Montserrat', sans-serif;
        }


        .box6 {
            grid-area: cont;
            min-height: 800px;
            justify-content: center;
            border-right: 2px solid black;
            border-left: 2px solid black;
            border-bottom: 2px solid black;
        }

        .navbar navbar-inverse {
            background-color: #1A2090;
            border-color: #131A91;
        }


        #fontstyle {
            font-family: 'Montserrat', sans-serif;
            color: white;
            width: 60%;
        }

        #white {
            color: white;
        }

        /* Add some top padding to the page content to prevent sudden quick movement (as the navigation bar gets a new position at the top of the page (position:fixed and top:0) */
        .sticky + .content {
            padding-top: 60px;
        }

        .page-footer {
            flex-grow: 0;
            flex-shrink: 0;
        }

        {#style="display: flex; flex-direction: row; gap: 10px;"#}

        @media only screen and (max-width: 740px) {

            .rightaffiliate {
                display: none;
            }

            .box2 {
                grid-area: nv;
                background-color: #1A2090;
                display: flex;
            }

            img {
                width: 80%;
            }

            #newdivattribute {
                width: 50%;
            }

            #cardcontent {
                padding-left: 5%;
            }

            #ulbar {
                display: flex;
                flex-direction: column;
                gap: 10px;
                justify-content: center;
                flex-shrink: 1;
            }

            ul {
                color: white;
                text-align: center;
            }

            #searchinput {
                min-width: 70%;
                min-height: 45px;
                margin: 10px 10px 10px 14%;
            }

            #sortbutton {
                margin-left: 5%;
            }

            .wrapper {
                display: grid;
                grid-template-columns: repeat(1, 1fr);
                grid-auto-rows: minmax(75px, auto);
                grid-template-areas:
            "lg"
            "head"
            "hd "
            "nv "
            "cont "
            "ft ";
            }

            #logosize {
                width: 25%;
                height: auto;
            }

            #forsale {
                padding-top: 25px;
            }

            select {
                min-width: 70%;
                min-height: 45px;
                margin: 10px 10px 10px 0px;
            }

            .low {
                grid-area: head;
            }

            .box1 {
                grid-area: hd;
            }

            .leftaffiliate {
                display: none;
            }

            #cardwidth {
                width: 70%;
            }

        }

        @media only screen and (min-width: 741px) and (max-width: 1800px) {


            .box2 {
                grid-area: nv;
                background-color: #1A2090;
                width: auto;
                display: flex;
            }

            .selectclass {
                padding-top: 10px;
            }

            select {
                flex-shrink: 1;
                width: auto;

            }

            #newdivattribute {
                width: 65%;
            }

            #sortbutton {
                margin-left: 150px;
            }

            #containerpadding {
                padding-left: 10px;
            }

            #ulbar {
                flex-wrap: wrap;
                display: flex;
                flex-direction: row;
                gap: 10px;
                padding-top: 25px;
                justify-content: left;
            }

            #listyle {
                padding-right: 20px;
                text-align: center;
            }

            #logosize {
                width: 100%;
                height: auto;
            }

            .wrapper {
                display: grid;
                grid-template-columns: 15% 70% 15%;
                grid-auto-rows: minmax(75px, auto);
                grid-template-areas:
                "lg .. .. "
                " .. hd ..   "
                "ra nv la  "
                "ra cont la"
                "ft ft ft ";
            }


            @media only screen and (min-width: 1200px) {
                .rightaffiliate {
                    z-index: -1;
                    grid-area: ra;
                }
            }

            @media only screen and (max-width: 1200px) {
                .rightaffiliate {
                    display: none;
                }

                .leftaffiliate {
                    display: none;
                }
            }

            #forsale {
                padding-top: 25px;
            }

            .box1 {
                grid-area: hd;
                justify-self: center;
            }

            .leftaffiliate {
                padding-left: 50px;
                grid-area: la;
            }

        }

        @media only screen and (min-width: 1200px) and (max-width: 1450px) {
            #cardwidth {
                width: 60%;
            }
        }

        @media only screen and (min-width: 1800px) {



            .box2 {
                grid-area: nv;
                background-color: #1A2090;
                display: flex;
            }

            #sortbutton {
                margin-left: 200px;
            }

            #newdivattribute {
                width: 90%;
            }

            #forsale {
                padding-top: 75px;
            }

            #containerpadding {
                padding-top: 20px;
                padding-left: 10px;
            }

            #logosize {
                width: 100%;
                height: auto;
            }

            #listyle {
                padding-right: 20px;
            }

            #ulbar {
                display: flex;
                flex-direction: row;
                gap: 10px;
                justify-content: center;
            }


            select {
                min-width: 10%;
                min-height: 45px;
                margin: 10px 10px 10px 0px;
            }

            .wrapper {
                display: grid;
                grid-template-columns: repeat(9, 1fr);
                grid-auto-rows: minmax(75px, auto);
                grid-template-areas:
            "lg hd hd hd   hd   hd   hd   hd   hd"
            "ra nv nv nv   nv   nv   nv   la   la"
            "ra cont cont cont cont cont cont la la"
            ".. ft ft ft   ft   ft   ft   ft   ..";
            }

            .leftaffiliate {
                padding-left: 50px;
                grid-area: la;
            }

            .rightaffiliate {
                  z-index: -1;
                grid-area: ra;
            }

            .box1 {

                grid-area: hd;
                justify-self: center;
            }
        }


    </style>
</head>
<body>

<!-- End TrustBox widget -->
<div class="wrapper">
    <div class="logo">
        <a href="/"><img src="/static/images/mainlogo.png" alt="mainlogo" id="logosize" style="float: left;"></a>
    </div>
    <div class="low">
        {% if session['type'] == 'sales' %}
            <form style="padding-top: 0px; margin-top: 0px; height: 0%;" action="{{ url_for("search") }}"
                  id="searchbutton"
                  method="post" name="search">
                <input type="hidden" name="page" value="lettings">
                <input type="hidden" name="pcode" value="{{ session['postcode'] }}">
                <button class="btn" id="lettings" type="submit" name="lettings" value="lettings"
                        style="color: white;"><i class="fa fa-external-link-square" aria-hidden="true"></i>
                    <a class="toggle" style="color: black; font-size: 20px;">Go to Lettings</a>
                </button>
            </form>
            <script>
                function pupdate() {
                    console.log("new selection made")
                    document.getElementById("search").submit();
                }

                document.getElementById("lettings").addEventListener("click", pupdate);
            </script>
            </div>
        {% endif %}
    {% if session['type'] == 'lettings' %}
        <a href="#">
            <div class="dropdown">
                <form class="navbar-form navbar-left" action="{{ url_for("search") }}" id="searchbutton"
                      method="post" name="search">
                    <input type="hidden" name="page" value="sales">
                    <input type="hidden" name="pcode" value="{{ session['postcode'] }}">
                    <button class="btn" id="lettings" type="submit" name="sales" value="sales"
                            style="color: black;">
                        <a class="toggle" style="color: black; font-size: 20px;">Go to Sales</a>
                    </button>
                </form>
            </div>
        </a>
        <script>
            function pupdate() {
                console.log("new selection made")
                document.getElementById("search").submit();
            }

            document.getElementById("lettings").addEventListener("click", pupdate);
        </script>
        </div>
    {% endif %}


<div class="box2">
    <div class="container" id="containerpadding" style="width: 90%; padding-top: 5%;">
        <div class="container topics">
            {% if session['type'] == 'sales' %}
                <ul class="nav navbar-nav">

                    <li id="listyle">
                        <div>
                            <a class="dropdown-toggle" data-toggle="dropdown" id="fontstyle"
                               style="background-color: transparent;">
                                <i class="fa fa-external-link-square" aria-hidden="true"></i>For Sale</a>
                            <ul class="dropdown-menu" id="fontstyle"
                                style="text-align: center; display: flex; background-color:#1a2090; display: none;">
                                <li><a id=rmovesale value=0 style="color: white; text-align: center;">RightMove</a></li>
                                <li style="text-align: center;"><a style="color: white;" href=#
                                                                   id=otmsale>OnTheMarket</a></li>
                                <li style="color: white; text-align: center;"><a style="color: white;" id=gumtree>Gumtree</a>
                                </li>
                                <li style="color: white; text-align: center;"><a style="color: white;" id=allsales>All
                                    Results</a></li>
                            </ul>
                        </div>
                    </li>
                    <li id="listyle">
                        <!--add id=planningdata for use of the API to the a tag ckass="toggle" -->
                        <div class="dropdown"><a class="toggle" style="color: white;"><i
                                class="fa fa-area-chart" aria-hidden="true"
                                style="justify-content: center; color: white;"></i>
                            Local Planning</a></div>
                    </li>
                    {% if session['postcode']|length > 5 %}
                        <li id="listyle">
                            <div class="dropdown"><a id=crysdata class="toggle" style="color: white;">
                                <i class="fa fa-signal" aria-hidden="true" style="justify-content: center;"></i>
                                Local Area Statistics
                            </a></div>
                        </li>
                    {% endif %}
                    <li>
                        <div class="dropdown">
                            <a class="dropdown-toggle" data-toggle="dropdown" style="color: white;">
                                <i class="fa fa-line-chart" style="justify-content: center;" aria-hidden="true"></i>
                                Sold Properties</a>
                            <ul class="dropdown-menu" style="background-color:#1a2090; display: none;">
                                {% if session['postcode']|length > 5 %}
                                    <li><a style="color: white;" id=soldpricejson>Land Registry Sold</a></li>
                                {% endif %}
                                <li><a style="color: white;" id=rmovesold>RightMove Sold</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>

                    </li>
                </ul>

            {% endif %}
            {% if session['type'] == 'lettings' %}
                <ul class="nav navbar-nav">
                    <li id="listyle">
                        <div class="dropdown show">
                            <a class="dropdown-toggle" data-toggle="dropdown" id="fontstyle">
                                <i class="fa fa-external-link-square" aria-hidden="true"></i>To Rent</a>
                            <ul class="dropdown-menu" id="fontstyle" style="background-color:#1a2090; display: none;">
                                <li><a id=rmovelets>RightMove</a></li>
                                <li><a id=otmrent>OnTheMarket</a></li>
                                <li><a id=gumtree>Gumtree</a></li>
                            </ul>
                        </div>
                    </li>
                    {% if session['postcode']|length > 5 %}
                        <li id="listyle">
                            <div class="dropdown"><a id=crysdata class="toggle" style="color: white;">
                                <i class="fa fa-signal" aria-hidden="true" style="justify-content: center;"></i>
                                Local Area Statistics
                            </a></div>
                        </li>
                    {% endif %}
                </ul>
            {% endif %}

        </div>

        <ul class="nav navbar-nav " id="ulbar">
            <li>
                <form action="{{ url_for("update_pcode") }}" method="post" name="exampleform"
                      style="padding-top: 13px;">
                    <input style="min-width: 200px; font-size: 10px;" id="autocomplete" name="pcodeupdate"
                           placeholder="Enter a postcode..." type="text"/>
                    <script>


                        var form = document.getElementsByName("exampleform");

                        document.getElementById("autocomplete").addEventListener("click", function () {
                            form.submit();
                        });

                        let autocomplete;

                        function initAutocomplete() {
                            autocomplete = new google.maps.places.Autocomplete(
                                document.getElementById('autocomplete'),
                                {
                                    {#'locality', 'neighborhood', 'plus_code', 'street_address' 'postal_code', 'post_code_prefix', 'postal_code_suffix', #}
                                    types: ['postal_code'],
                                    componentRestrictions: {country: ['UK']},
                                    fields: ['address_components', 'postal_code']
                                });
                            autocomplete.classList.add("focused");
                        }

                        var input = document.getElementById('autocomplete');

                        input.addEventListener("click", message, {once: true});

                        function message() {
                            alert("Try using a full postcode to unlock local statistics and sold prices from the land registry.")
                        }

                    </script>
                    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDQugco0qDg4hEiieAj99EhInwk_T8eFsU&libraries=places&callback=initAutocomplete"
                            async defer></script>
                </form>
                <script>

                    const idel = document.getElementById("searchinput");
                    idel.addEventListener("input", autocompleteAName);


                    async function autocompleteAName(e) {

                        let pcode = e.target.value;
                        const url = 'https://api.geoapify.com/v1/geocode/autocomplete?text=';
                        const url_end = '&format=json&apiKey=f6158bd8aa4846fb9a97b27077d9a132';
                        const api_url = url + pcode + url_end;

                        const myjson = await fetch(api_url);
                        var data = await myjson.json();

                        console.log(data);
                        show(data);
                    }


                    function show(data) {
                        console.log("data.results[0]: " + data.results);
                        var datalist = document.getElementById("postcodeinputs");

                        for (var i = 0; i < data.results.length; i++) {
                            var n_option = document.createElement('option');

                            console.log("data[i]: " + data.results[i].address_line2);
                            var option_txt = document.createTextNode(data.results[i].address_line2);
                            n_option.setAttribute("value", data.results[i].postcode);
                            n_option.appendChild(option_txt);
                            datalist.append(n_option);

                        }
                    }

                    function pupdate() {
                        console.log("new selection made")
                        document.getElementById("update_pcode").submit();
                    }

                    document.getElementById("pcode&radius").addEventListener("click", pupdate);
                </script>
            </li>
            <li>
                <form action="{{ url_for("update_radius") }}" method="post" name="radiusform" id="selection">
                    <select onmousedown="if(this.options.length>1){this.size=7;}"
                            onmouseleave="if(this.options.length>1){this.size=1;}" class="selectclass"
                            id="pcode&radius"
                            onchange="this.form.submit()"
                            style="border: none; background-color: #1A2090; color: white; width: 110px; font-size: 15px;"
                            name="radius">
                        <option>Radius: {{ session['radius'] }}</option>
                        <option value="0">+0 miles</option>
                        <option value="0.25">+0.25 miles</option>
                        <option value="o.5">+0.5 miles</option>
                        <option value="1">+1 miles</option>
                        <option value="3">+3 miles</option>
                        <option value="5">+5 miles</option>
                        <option value="10">+10 miles</option>
                        <option value="15">+15 miles</option>
                        <option value="30">+30 miles</option>
                        <option value="50">+50 miles</option>
                    </select>
                </form>
                </form>
            </li>
            <li>
                <form action="{{ url_for("update_rooms") }}" method="post" name="minrooms" id="selection">
                    <select id="minrooms" class="form-select form-select-sm" class="selectclass"
                            onmousedown="if(this.options.length>1){this.size=6;}"
                            onmouseleave="if(this.options.length>1){this.size=0;}" name="minrooms"
                            style="border: none; background-color: #1A2090; color: white; width: auto; font-size: 15px;"
                            onchange="this.form.submit()">
                        <option value="Number of Beds">Min Rooms: {{ session['brooms'] }}</option>
                        <option value="0">Studio</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                    </select>
                </form>
                <script>
                    function pupdate() {
                        console.log("new selection made")
                        document.getElementById("update_rooms").submit();
                    }

                    document.getElementById("minrooms").addEventListener("click", pupdate);

                </script>
            </li>
            <li>
                <form action="{{ url_for("update_maxrooms") }}" method="post" name="minrooms" id="selection">
                    <select id="maxrooms" class="form-select form-select-sm" class="selectclass"
                            onmousedown="if(this.options.length>1){this.size=6;}"
                            onmouseleave="if(this.options.length>1){this.size=0;}" name="maxroom"
                            style="border: none; background-color: #1A2090; color: white; width: auto; font-size: 15px;"
                            onchange="this.form.submit()">
                        <option value="Number of Beds">Max Rooms: {{ session['maxrooms'] }}</option>
                        <option value="0">Studio</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                    </select>
                </form>
                <script>
                    function pupdate() {
                        console.log("new selection made")
                        document.getElementById("update_rooms").submit();
                    }

                    document.getElementById("minrooms").addEventListener("click", pupdate);

                </script>
            </li>
            <li style="width: auto; flex-shrink: 2;">
                <form action="{{ url_for("update_type") }}" method="post" name="type" id="selection">
                    <select id="propertytype" class="form-select form-select-sm" name="propertytype"
                            class="selectclass"
                            onmousedown="if(this.options.length>1){this.size=6;}"
                            onmouseleave="if(this.options.length>1){this.size=0;}"
                            style="border: none; background-color: #1A2090; color: white; width: auto; font-size: 15px;"
                            onchange="this.form.submit()">
                        <option>Property Type: {{ session['propertytype'] }}</option>
                        <option value="houses">Houses</option>
                        <option value="flats">Flats/ Apartments</option>
                        <option value="bungalows">Bungalows</option>
                    </select>
                </form>
            </li>
            {% if session['type'] == 'sales' %}
                <li>
                    <form action="{{ url_for("update_min_price") }}" id="minprice" method="post" name="minprice"
                          id="selection">
                        <select id="minpriceoptions" class="form-select form-select-sm "
                                onmousedown="if(this.options.length>15){this.size=15;}"
                                onmouseleave="if(this.options.length>15){this.size=0;}" name="minprice"
                                style="border: none; background-color: #1A2090; flex-shrink: 2; color: white; width: auto; font-size: 15px;"
                                onchange="this.form.submit()">
                            <option>Min Price: {{ session['minprice'] }}</option>
                            <option value="50000"
                            >£50,000
                            </option>
                            <option value="60000"
                            >£60,000
                            </option>
                            <option value="70000"
                            >£70,000
                            </option>
                            <option value="80000"
                            >£80,000
                            </option>
                            <option value="90000"
                            >£90,000
                            </option>
                            <option value="100000"
                            >£100,000
                            </option>
                            <option value="110000"
                            >£110,000
                            </option>
                            <option value="120000"
                            >£120,000
                            </option>
                            <option value="125000"
                            >£125,000
                            </option>
                            <option value="130000"
                            >£130,000
                            </option>
                            <option value="140000"
                            >£140,000
                            </option>
                            <option value="150000"
                            >£150,000
                            </option>
                            <option value="160000"
                            >£160,000
                            </option>
                            <option value="170000"
                            >£170,000
                            </option>
                            <option value="175000"
                            >£175,000
                            </option>
                            <option value="180000"
                            >£180,000
                            </option>
                            <option value="190000"
                            >£190,000
                            </option>
                            <option value="200000"
                            >£200,000
                            </option>
                            <option value="210000"
                            >£210,000
                            </option>
                            <option value="220000"
                            >£220,000
                            </option>
                            <option value="230000"
                            >£230,000
                            </option>
                            <option value="240000"
                            >£240,000
                            </option>
                            <option value="250000"
                            >£250,000
                            </option>
                            <option value="260000"
                            >£260,000
                            </option>
                            <option value="270000"
                            >£270,000
                            </option>
                            <option value="280000"
                            >£280,000
                            </option>
                            <option value="290000"
                            >£290,000
                            </option>
                            <option value="300000"
                            >£300,000
                            </option>
                            <option value="325000"
                            >£325,000
                            </option>
                            <option value="350000"
                            >£350,000
                            </option>
                            <option value="375000"
                            >£375,000
                            </option>
                            <option value="400000"
                            >£400,000
                            </option>
                            <option value="425000"
                            >£425,000
                            </option>
                            <option value="450000"
                            >£450,000
                            </option>
                            <option value="475000"
                            >£475,000
                            </option>
                            <option value="500000"
                            >£500,000
                            </option>
                            <option value="550000"
                            >£550,000
                            </option>
                            <option value="600000"
                            >£600,000
                            </option>
                            <option value="650000"
                            >£650,000
                            </option>
                            <option value="700000"
                            >£700,000
                            </option>
                            <option value="800000"
                            >£800,000
                            </option>
                            <option value="900000"
                            >£900,000
                            </option>
                            <option value="1000000"
                            >£1,000,000
                            </option>
                            <option value="1250000"
                            >£1,250,000
                            </option>
                            <option value="1500000"
                            >£1,500,000
                            </option>
                            <option value="1750000"
                            >£1,750,000
                            </option>
                            <option value="2000000"
                            >£2,000,000
                            </option>
                            <option value="2500000"
                            >£2,500,000
                            </option>
                            <option value="3000000"
                            >£3,000,000
                            </option>
                            <option value="4000000"
                            >£4,000,000
                            </option>
                            <option value="5000000"
                            >£5,000,000
                            </option>
                            <option value="7500000"
                            >£7,500,000
                            </option>
                            <option value="10000000"
                            >£10,000,000
                            </option>
                            <option value="15000000"
                            >£15,000,000
                            </option>
                            <option value="20000000"
                            >£20,000,000
                            </option>
                        </select>
                    </form>
                    <script>
                        function pupdate() {
                            console.log("new selection made")
                            document.getElementById("update_min_price").submit();
                        }

                        document.getElementById("minprice").addEventListener("click", pupdate);
                    </script>
                </li>
                <li>
                    <form action="{{ url_for("update_max_price") }}" id="maxprice selection" method="post"
                          name="maxprice">
                        <select id="maxprice" name="maxprice"
                                onmousedown="if(this.options.length>15){this.size=15;}"
                                onmouseleave="if(this.options.length>15){this.size=0;}"
                                style="border: none; background-color: #1A2090; color: white; width: auto; font-size: 15px;"
                                onchange="this.form.submit()">
                            <option>Max Price {{ session['maxprice'] }}</option>
                            <option value="50000"
                            >£50,000
                            </option>
                            <option value="60000"
                            >£60,000
                            </option>
                            <option value="70000"
                            >£70,000
                            </option>
                            <option value="80000"
                            >£80,000
                            </option>
                            <option value="90000"
                            >£90,000
                            </option>
                            <option value="100000"
                            >£100,000
                            </option>
                            <option value="110000"
                            >£110,000
                            </option>
                            <option value="120000"
                            >£120,000
                            </option>
                            <option value="125000"
                            >£125,000
                            </option>
                            <option value="130000"
                            >£130,000
                            </option>
                            <option value="140000"
                            >£140,000
                            </option>
                            <option value="150000"
                            >£150,000
                            </option>
                            <option value="160000"
                            >£160,000
                            </option>
                            <option value="170000"
                            >£170,000
                            </option>
                            <option value="175000"
                            >£175,000
                            </option>
                            <option value="180000"
                            >£180,000
                            </option>
                            <option value="190000"
                            >£190,000
                            </option>
                            <option value="200000"
                            >£200,000
                            </option>
                            <option value="210000"
                            >£210,000
                            </option>
                            <option value="220000"
                            >£220,000
                            </option>
                            <option value="230000"
                            >£230,000
                            </option>
                            <option value="240000"
                            >£240,000
                            </option>
                            <option value="250000"
                            >£250,000
                            </option>
                            <option value="260000"
                            >£260,000
                            </option>
                            <option value="270000"
                            >£270,000
                            </option>
                            <option value="280000"
                            >£280,000
                            </option>
                            <option value="290000"
                            >£290,000
                            </option>
                            <option value="300000"
                            >£300,000
                            </option>
                            <option value="325000"
                            >£325,000
                            </option>
                            <option value="350000"
                            >£350,000
                            </option>
                            <option value="375000"
                            >£375,000
                            </option>
                            <option value="400000"
                            >£400,000
                            </option>
                            <option value="425000"
                            >£425,000
                            </option>
                            <option value="450000"
                            >£450,000
                            </option>
                            <option value="475000"
                            >£475,000
                            </option>
                            <option value="500000"
                            >£500,000
                            </option>
                            <option value="550000"
                            >£550,000
                            </option>
                            <option value="600000"
                            >£600,000
                            </option>
                            <option value="650000"
                            >£650,000
                            </option>
                            <option value="700000"
                            >£700,000
                            </option>
                            <option value="800000"
                            >£800,000
                            </option>
                            <option value="900000"
                            >£900,000
                            </option>
                            <option value="1000000"
                            >£1,000,000
                            </option>
                            <option value="1250000"
                            >£1,250,000
                            </option>
                            <option value="1500000"
                            >£1,500,000
                            </option>
                            <option value="1750000"
                            >£1,750,000
                            </option>
                            <option value="2000000"
                            >£2,000,000
                            </option>
                            <option value="2500000"
                            >£2,500,000
                            </option>
                            <option value="3000000"
                            >£3,000,000
                            </option>
                            <option value="4000000"
                            >£4,000,000
                            </option>
                            <option value="5000000"
                            >£5,000,000
                            </option>
                            <option value="7500000"
                            >£7,500,000
                            </option>
                            <option value="10000000"
                            >£10,000,000
                            </option>
                            <option value="15000000"
                            >£15,000,000
                            </option>
                            <option value="20000000"
                            >£20,000,000
                            </option>
                        </select>
                    </form>
                    <script>
                        function pupdate() {
                            console.log("new selection made")
                            document.getElementById("update_max_price").submit();
                        }

                        document.getElementById("maxprice").addEventListener("click", pupdate);
                    </script>
                </li>

            {% endif %}
            {% if session['type'] == 'lettings' %}
                <li>
                    <form action="{{ url_for("update_min_price") }}" id="minprice" id="selection" method="post"
                          name="minprice">
                        <select id="minpriceoptions" class="selectclass" name="minprice"
                                onmousedown="if(this.options.length>15){this.size=15;}"
                                onmouseleave="if(this.options.length>15){this.size=0;}"
                                style="border: none; background-color: #1A2090; color: white; width: auto; font-size: 15px;"
                                onchange="this.form.submit()">
                            <option value="100">Min Price: {{ session['minprice'] }}</option>
                            <option value="100">100 PCM</option>
                            <option value="150">150 PCM</option>
                            <option value="200">200 PCM</option>
                            <option value="250">250 PCM</option>
                            <option value="300">300 PCM</option>
                            <option value="350">350 PCM</option>
                            <option value="400">400 PCM</option>
                            <option value="450">450 PCM</option>
                            <option value="500">500 PCM</option>
                            <option value="600">600 PCM</option>
                            <option value="700">700 PCM</option>
                            <option value="800">800 PCM</option>
                            <option value="900">900 PCM</option>
                            <option value="1000">1,000 PCM</option>
                            <option value="1100">1,100 PCM</option>
                            <option value="1200">1,200 PCM</option>
                            <option value="1250">1,250 PCM</option>
                            <option value="1300">1,300 PCM</option>
                            <option value="1400">1,400 PCM</option>
                            <option value="1500">1,500 PCM</option>
                            <option value="1750">1,750 PCM</option>
                            <option value="2000">2,000 PCM</option>
                            <option value="2250">2,250 PCM</option>
                            <option value="2500">2,500 PCM</option>
                            <option value="2750">2,750 PCM</option>
                            <option value="3000">3,000 PCM</option>
                            <option value="3500">3,500 PCM</option>
                            <option value="4000">4,000 PCM</option>
                            <option value="4500">4,500 PCM</option>
                            <option value="5000">5,000 PCM</option>
                            <option value="5500">5,500 PCM</option>
                            <option value="6000">6,000 PCM</option>
                            <option value="6500">6,500 PCM</option>
                            <option value="7000">7,000 PCM</option>
                            <option value="8000">8,000 PCM</option>
                            <option value="9000">9,000 PCM</option>
                            <option value="10000">10,000 PCM</option>
                            <option value="12500">12,500 PCM</option>
                            <option value="15000">15,000 PCM</option>
                            <option value="17500">17,500 PCM</option>
                            <option value="20000">20,000 PCM</option>
                            <option value="25000">25,000 PCM</option>
                            <option value="30000">30,000 PCM</option>
                            <option value="35000">35,000 PCM</option>
                            <option value="40000">40,000 PCM</option>
                        </select>
                        <script>
                            function pupdate() {
                                console.log("new selection made")
                                document.getElementById("update_min_price").submit();
                            }

                            document.getElementById("minpriceoptions").addEventListener("click", pupdate);
                        </script>
                    </form>
                </li>
                <li>
                    <form action="{{ url_for("update_max_price") }}" id="maxprice" id="selection" method="post"
                          name="maxprice">
                        <select class="selectclass" id="maxprice" name="maxprice"
                                onmousedown="if(this.options.length>15){this.size=15;}"
                                onmouseleave="if(this.options.length>15){this.size=0;}"
                                style="border: none; background-color: #1A2090; color: white; width: auto; font-size: 15px;"
                                onchange="this.form.submit()">
                            <option value="100">Max Price: {{ session['maxprice'] }}</option>
                            <option value="150">150 PCM</option>
                            <option value="200">200 PCM</option>
                            <option value="250">250 PCM</option>
                            <option value="300">300 PCM</option>
                            <option value="350">350 PCM</option>
                            <option value="400">400 PCM</option>
                            <option value="450">450 PCM</option>
                            <option value="500">500 PCM</option>
                            <option value="600">600 PCM</option>
                            <option value="700">700 PCM</option>
                            <option value="800">800 PCM</option>
                            <option value="900">900 PCM</option>
                            <option value="1000">1,000 PCM</option>
                            <option value="1100">1,100 PCM</option>
                            <option value="1200">1,200 PCM</option>
                            <option value="1250">1,250 PCM</option>
                            <option value="1300">1,300 PCM</option>
                            <option value="1400">1,400 PCM</option>
                            <option value="1500">1,500 PCM</option>
                            <option value="1750">1,750 PCM</option>
                            <option value="2000">2,000 PCM</option>
                            <option value="2250">2,250 PCM</option>
                            <option value="2500">2,500 PCM</option>
                            <option value="2750">2,750 PCM</option>
                            <option value="3000">3,000 PCM</option>
                            <option value="3500">3,500 PCM</option>
                            <option value="4000">4,000 PCM</option>
                            <option value="4500">4,500 PCM</option>
                            <option value="5000">5,000 PCM</option>
                            <option value="5500">5,500 PCM</option>
                            <option value="6000">6,000 PCM</option>
                            <option value="6500">6,500 PCM</option>
                            <option value="7000">7,000 PCM</option>
                            <option value="8000">8,000 PCM</option>
                            <option value="9000">9,000 PCM</option>
                            <option value="10000">10,000 PCM</option>
                            <option value="12500">12,500 PCM</option>
                            <option value="15000">15,000 PCM</option>
                            <option value="17500">17,500 PCM</option>
                            <option value="20000">20,000 PCM</option>
                            <option value="25000">25,000 PCM</option>
                            <option value="30000">30,000 PCM</option>
                            <option value="35000">35,000 PCM</option>
                            <option value="40000">40,000 PCM</option>
                        </select>
                    </form>
                    <script>
                        function pupdate() {
                            console.log("new selection made")
                            document.getElementById("update_max_price").submit();
                        }

                        document.getElementById("maxprice").addEventListener("click", pupdate);
                    </script>
                </li>
            {% endif %}
        </ul>
    </div>
</div>

<div class="box6" style="background-color: #E9E9EB; text-align: center;">

    <h5 style="padding-top: 100px; text-align: center; padding-left: 10%; padding-right: 10%;">
        Property {{ session['type'] }} results for: {{ session['display'] }} in the radius of {{ session['radius'] }}
        mile
        in the range of £{{ session['minprice'] }} to £{{ session['maxprice'] }} for properties
        with {{ session['brooms'] }}
        to {{ session['maxrooms'] }} rooms.</h5>
    <button id="sortbutton" class="btn" onClick="GFG_Fun()" style="margin: 0 auto;">
        Sort price Low to High
    </button>
    <button id="sortbutton" class="btn" onClick="High_Low()">
        Sort price High to Low
    </button>
    <h4 id="sessionvariable" style="padding-top: 100px;"></h4>
    <div id="forsale" class="container"
         style="max-width: 80%; justify-items: center; text-align: center; padding-top: 30px;">
        <div id="message"></div>
    </div>
    <script>

        function GFG_Fun() {
            var $wrap = $('#forsale');
            $wrap.find('.child').sort(function (a, b) {
                console.log("a sort: " + a);
                console.log("b sort: " + b);
                return +a.dataset.percentage -
                    +b.dataset.percentage;
            })
                .appendTo($wrap);
        }

        function High_Low() {
            var $wrap = $('#forsale');
            $wrap.find('.child').sort(function (a, b) {
                return +b.dataset.percentage -
                    +a.dataset.percentage;
            })
                .appendTo($wrap);
        }
    </script>

</div>
<div class="rightaffiliate">
    <iframe src="https://rcm-eu.amazon-adsystem.com/e/cm?o=2&p=14&l=ur1&category=pcvideogames&banner=0W3AN9S2F9G41BWHFD02&f=ifr&linkID=a0ec3dc90813f329f67d8167f4569db5&t=256308e-21&tracking_id=256308e-21" width="160" height="600" scrolling="no" border="0" marginwidth="0" style="border:none; position:fixed;" frameborder="0" sandbox="allow-scripts allow-same-origin allow-popups allow-top-navigation-by-user-activation"></iframe>
</div>
<div class="leftaffiliate">
    <iframe src="https://rcm-eu.amazon-adsystem.com/e/cm?o=2&p=14&l=ur1&category=baby&banner=0FSQZ5E33PEKXQ325P82&f=ifr&linkID=2c13582f52c4aacaaba8d1aa3e15c2f5&t=256308e-21&tracking_id=256308e-21" width="160" height="600" scrolling="no" border="0" marginwidth="0" style="border:none; position: fixed;" frameborder="0" sandbox="allow-scripts allow-same-origin allow-popups allow-top-navigation-by-user-activation"></iframe>
</div>
</div>
<script>
    $(document).foundation();
</script>
<script type="text/javascript">


    /* If the user clicks anywhere outside the select box,
    then close all select boxes: */


    window.onscroll = function () {
        myFunction()
    };

    var navbar = document.getElementById("scrollable");
    var sticky = navbar.offsetTop;

    function myFunction() {
        if (window.pageYOffset >= sticky) {
            navbar.classList.add("sticky")
        } else {
            navbar.classList.remove("sticky");
        }
    }


</script>
<footer class="page-footer outer"></footer>

<!-- End TrustBox widget -->
</body>
</html>
